@{
    ViewData["Title"] = "Chi tiết lịch hẹn";
    Layout = "~/vn.fpt.edu.views/Shared/_DashboardLayout.cshtml";
    var apiBaseUrl = ViewBag.ApiBaseUrl ?? "https://localhost:7173/api";
    var scheduleId = ViewBag.ServiceScheduleId;
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">
                        <i class="fas fa-calendar-check me-2"></i>
                        Chi tiết lịch hẹn
                    </h4>
                    <div>
                        <a href="/ServiceSchedules" class="btn btn-secondary">
                            <i class="fas fa-arrow-left me-1"></i>
                            Quay lại
                        </a>
                        <a href="/ServiceSchedules/Edit/@scheduleId" class="btn btn-primary" id="editBtn" style="display: none;">
                            <i class="fas fa-edit me-1"></i>
                            Chỉnh sửa
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div id="loadingSpinner" class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <div id="scheduleDetails" style="display: none;">
                        <div class="row">
                            <!-- Cột trái: Thông tin lịch hẹn -->
                            <div class="col-lg-6 col-md-12 mb-4">
                                <div class="card h-100" style="border-color: #e0e0e0;">
                                    <div class="card-header" style="background-color: #f5f5f5; border-bottom: 1px solid #e0e0e0;">
                                        <h5 class="mb-0" style="color: #666;">Thông tin lịch hẹn</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <h6 class="mb-2" style="color: #777;">Khách hàng</h6>
                                            <table class="table table-sm mb-3" style="margin-bottom: 0;">
                                                <tr>
                                                    <th width="35%" style="color: #666;">Tên khách hàng:</th>
                                                    <td id="userName">-</td>
                                                </tr>
                                                <tr>
                                                    <th style="color: #666;">Email:</th>
                                                    <td id="userEmail">-</td>
                                                </tr>
                                                <tr>
                                                    <th style="color: #666;">Điện thoại:</th>
                                                    <td id="userPhone">-</td>
                                                </tr>
                                            </table>
                                        </div>

                                        <hr style="margin: 1rem 0; border-color: #e0e0e0;">

                                        <div class="mb-3">
                                            <h6 class="mb-2" style="color: #777;">Thông tin xe</h6>
                                            <table class="table table-sm mb-3" style="margin-bottom: 0;">
                                                <tr>
                                                    <th width="35%" style="color: #666;">Tên xe:</th>
                                                    <td id="carName">-</td>
                                                </tr>
                                                <tr>
                                                    <th style="color: #666;">Biển số:</th>
                                                    <td id="licensePlate">-</td>
                                                </tr>
                                                <tr>
                                                    <th style="color: #666;">Model:</th>
                                                    <td id="carModel">-</td>
                                                </tr>
                                            </table>
                                        </div>

                                        <hr style="margin: 1rem 0; border-color: #e0e0e0;">

                                        <div class="mb-3">
                                            <h6 class="mb-2" style="color: #777;">Lịch hẹn</h6>
                                            <table class="table table-sm mb-3" style="margin-bottom: 0;">
                                                <tr>
                                                    <th width="35%" style="color: #666;">Ngày hẹn:</th>
                                                    <td id="scheduledDate">-</td>
                                                </tr>
                                                <tr>
                                                    <th style="color: #666;">Giờ hẹn:</th>
                                                    <td id="scheduledTime">-</td>
                                                </tr>
                                                <tr>
                                                    <th style="color: #666;">Chi nhánh:</th>
                                                    <td id="branchName">-</td>
                                                </tr>
                                                <tr>
                                                    <th style="color: #666;">Điện thoại chi nhánh:</th>
                                                    <td id="branchPhone">-</td>
                                                </tr>
                                                <tr>
                                                    <th style="color: #666;">Trạng thái:</th>
                                                    <td id="statusBadge">-</td>
                                                </tr>
                                            </table>
                                        </div>

                                        <div class="mt-3 pt-3 border-top" style="border-color: #e0e0e0 !important;" id="actionButtons">
                                            <div class="d-flex gap-2">
                                                <button class="btn btn-success" id="completeBtn" style="display: none;" onclick="completeSchedule()">
                                                    <i class="fas fa-check me-1"></i>
                                                    Hoàn thành
                                                </button>
                                                <button class="btn btn-danger" id="cancelBtn" style="display: none;" onclick="cancelSchedule()">
                                                    <i class="fas fa-times me-1"></i>
                                                    Hủy lịch hẹn
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Cột phải: Ghi chú / Nhật ký xử lý -->
                            <div class="col-lg-6 col-md-12 mb-4">
                                <div class="card h-100" style="border-color: #e0e0e0;">
                                    <div class="card-header d-flex justify-content-between align-items-center" style="background-color: #f5f5f5; border-bottom: 1px solid #e0e0e0;">
                                        <h5 class="mb-0" style="color: #666;">Ghi chú / Nhật ký xử lý</h5>
                                        <button class="btn btn-sm btn-secondary" data-bs-toggle="modal" data-bs-target="#addNoteModal" style="background-color: #6c757d; border-color: #6c757d;">
                                            <i class="fas fa-plus me-1"></i>
                                            Thêm ghi chú
                                        </button>
                                    </div>
                                    <div class="card-body" style="max-height: 600px; overflow-y: auto;">
                                        <div id="notesList">
                                            <div class="text-center text-muted py-3">
                                                <div class="spinner-border spinner-border-sm" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal xác nhận hủy lịch -->
<div class="modal fade" id="confirmCancelModal" tabindex="-1" aria-labelledby="confirmCancelModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmCancelModalLabel">
                    <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                    Xác nhận hủy lịch hẹn
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn hủy lịch hẹn này?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Không</button>
                <button type="button" class="btn btn-danger" onclick="confirmCancel()">
                    <i class="fas fa-times me-1"></i>
                    Có, hủy lịch
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal xác nhận hoàn thành -->
<div class="modal fade" id="confirmCompleteModal" tabindex="-1" aria-labelledby="confirmCompleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmCompleteModalLabel">
                    <i class="fas fa-check-circle me-2 text-success"></i>
                    Xác nhận hoàn thành lịch hẹn
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Bạn có chắc chắn muốn xác nhận hoàn thành lịch hẹn này?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Không</button>
                <button type="button" class="btn btn-success" onclick="confirmComplete()">
                    <i class="fas fa-check me-1"></i>
                    Có, hoàn thành
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal thêm ghi chú -->
<div class="modal fade" id="addNoteModal" tabindex="-1" aria-labelledby="addNoteModalLabel" aria-hidden="true" data-bs-backdrop="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addNoteModalLabel">
                    <i class="fas fa-sticky-note me-2"></i>
                    Thêm ghi chú mới
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="noteText" class="form-label">Nội dung ghi chú:</label>
                    <textarea class="form-control" id="noteText" rows="4" placeholder="Ví dụ: 15:40 - Gọi khách không nghe máy"></textarea>
                    <small class="form-text text-muted">Ghi lại toàn bộ quá trình làm việc với khách hàng</small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary" onclick="addNote()">
                    <i class="fas fa-save me-1"></i>
                    Lưu ghi chú
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Đảm bảo xóa backdrop khi modal đóng
    $('#addNoteModal, #confirmCancelModal, #confirmCompleteModal').on('hidden.bs.modal', function () {
        // Xóa tất cả backdrop
        $('.modal-backdrop').remove();
        // Xóa class modal-open
        $('body').removeClass('modal-open');
        // Reset CSS
        $('body').css({
            'overflow': '',
            'padding-right': ''
        });
        // Đảm bảo body có thể scroll
        $('html, body').css('overflow', 'auto');
    });
</script>

@section Scripts {
    <script>
        const API_BASE_URL = '@apiBaseUrl';
        const scheduleId = @scheduleId;

        $(document).ready(function() {
            loadScheduleDetails();
            loadNotes();
        });

        function loadScheduleDetails() {
            const token = localStorage.getItem('authToken');
            fetch(`${API_BASE_URL}/ServiceSchedule/${scheduleId}`, {
                headers: {
                    'Authorization': token ? `Bearer ${token}` : '',
                    'Content-Type': 'application/json'
                }
            })
            .then(async response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                return response.json();
            })
            .then(result => {
                if (result.success && result.data) {
                    const schedule = result.data;
                    displayScheduleDetails(schedule);
                } else {
                    showToast('Không tìm thấy lịch hẹn', 'error');
                }
            })
            .catch(error => {
                console.error('Error loading schedule:', error);
                $('#loadingSpinner').html('<p class="text-danger">Lỗi tải dữ liệu: ' + error.message + '</p>');
            });
        }

        function displayScheduleDetails(schedule) {
            $('#userName').text(schedule.userName || '-');
            $('#userEmail').text(schedule.userEmail || '-');
            $('#userPhone').text(schedule.userPhone || '-');
            $('#carName').text(schedule.carName || '-');
            $('#licensePlate').text(schedule.licensePlate || '-');
            $('#carModel').text(schedule.carModel || '-');
            
            // Xử lý timezone cho scheduledDate
            let scheduleDateStr = schedule.scheduledDate;
            if (typeof scheduleDateStr === 'string' && !scheduleDateStr.endsWith('Z') && !scheduleDateStr.includes('+') && !scheduleDateStr.includes('-', 10)) {
                scheduleDateStr = scheduleDateStr + 'Z';
            }
            const date = new Date(scheduleDateStr);
            $('#scheduledDate').text(date.toLocaleDateString('vi-VN'));
            $('#scheduledTime').text(date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' }));
            
            $('#branchName').text(schedule.branchName || '-');
            $('#branchPhone').text(schedule.branchPhone || '-');

            let statusBadge = '';
            switch(schedule.statusCode) {
                case 'PENDING':
                    statusBadge = '<span class="badge bg-warning">Chờ xử lý</span>';
                    break;
                case 'IN_PROGRESS':
                    statusBadge = '<span class="badge bg-primary">Đang xử lý</span>';
                    break;
                case 'CONFIRMED':
                    statusBadge = '<span class="badge bg-info">Đã xác nhận</span>';
                    break;
                case 'CANCELLED':
                    statusBadge = '<span class="badge bg-danger">Đã hủy</span>';
                    break;
                case 'COMPLETED':
                    statusBadge = '<span class="badge bg-success">Hoàn thành</span>';
                    break;
                default:
                    statusBadge = '<span class="badge bg-secondary">' + (schedule.statusName || schedule.statusCode) + '</span>';
            }
            $('#statusBadge').html(statusBadge);

            // Show/hide action buttons based on status
            // Cho phép chỉnh sửa/hủy/hoàn thành khi status là PENDING hoặc IN_PROGRESS
            if (schedule.statusCode === 'PENDING' || schedule.statusCode === 'IN_PROGRESS') {
                $('#editBtn').show();
                $('#cancelBtn').show();
                $('#completeBtn').show();
            } else {
                // Ẩn nút khi đã CONFIRMED, CANCELLED, hoặc COMPLETED
                $('#editBtn').hide();
                $('#cancelBtn').hide();
                $('#completeBtn').hide();
            }

            $('#loadingSpinner').hide();
            $('#scheduleDetails').show();
        }

        function loadNotes() {
            const token = localStorage.getItem('authToken');
            fetch(`${API_BASE_URL}/ServiceSchedule/${scheduleId}/notes`, {
                headers: {
                    'Authorization': token ? `Bearer ${token}` : '',
                    'Content-Type': 'application/json'
                }
            })
            .then(async response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                return response.json();
            })
            .then(result => {
                if (result.success && result.data) {
                    displayNotes(result.data);
                } else {
                    displayNotes([]);
                }
            })
            .catch(error => {
                console.error('Error loading notes:', error);
                displayNotes([]);
            });
        }

        function displayNotes(notes) {
            const notesList = $('#notesList');
            notesList.empty();

            if (notes.length === 0) {
                notesList.html('<p class="text-muted text-center py-3">Chưa có ghi chú nào</p>');
                return;
            }

            notes.forEach(note => {
                // Xử lý timezone - backend trả về UTC, cần convert sang local time
                let dateStr = note.createdAt;
                
                // Nếu không có timezone indicator (Z hoặc +XX:XX), thêm Z để đánh dấu là UTC
                if (typeof dateStr === 'string') {
                    if (!dateStr.endsWith('Z') && !dateStr.includes('+') && !dateStr.includes('-', 10)) {
                        // Nếu không có timezone, giả sử là UTC và thêm Z
                        dateStr = dateStr.endsWith('Z') ? dateStr : dateStr + 'Z';
                    }
                }
                
                const date = new Date(dateStr);
                
                // Format theo timezone local của người dùng
                const formattedDate = date.toLocaleString('vi-VN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const noteHtml = `
                    <div class="border-start border-3 mb-3 p-3" style="border-color: ${note.isAssignmentNote ? '#28a745' : '#007bff'} !important; background-color: #f8f9fa;">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <strong>${note.consultantName || 'Unknown'}</strong>
                                ${note.isAssignmentNote ? '<span class="badge bg-success ms-2">Nhận đơn</span>' : ''}
                            </div>
                            <small class="text-muted">${formattedDate}</small>
                        </div>
                        <p class="mb-0" style="white-space: pre-wrap;">${escapeHtml(note.note)}</p>
                    </div>
                `;
                notesList.append(noteHtml);
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showToast(message, type) {
            const bgColor = type === 'success' ? '#28a745' : '#dc3545';
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            
            const toast = $(`
                <div class="toast-notification" style="
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background-color: ${bgColor};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 4px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                    z-index: 9999;
                    min-width: 250px;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                ">
                    <i class="fas ${icon}"></i>
                    <span>${message}</span>
                </div>
            `);
            
            $('body').append(toast);
            
            setTimeout(() => {
                toast.fadeOut(300, function() {
                    $(this).remove();
                });
            }, 3000);
        }

        function addNote() {
            const noteText = $('#noteText').val().trim();
            
            if (!noteText) {
                showAlert('Vui lòng nhập nội dung ghi chú', 'warning');
                return;
            }

            const token = localStorage.getItem('authToken');
            const userInfoStr = localStorage.getItem('userInfo');

            if (!token || !userInfoStr) {
                showAlert('Vui lòng đăng nhập để thêm ghi chú', 'warning');
                return;
            }

            let userInfo;
            try {
                userInfo = JSON.parse(userInfoStr);
            } catch (error) {
                console.error('Không thể phân tích thông tin người dùng:', error);
                showAlert('Không thể xác định thông tin người dùng. Vui lòng đăng nhập lại.', 'danger');
                return;
            }

            // Lấy userId từ userInfo hoặc decode từ token
            let consultantId = Number(userInfo.userId || userInfo.id || userInfo.UserId);
            
            // Nếu không có userId, decode từ JWT token
            if (!consultantId && token) {
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    consultantId = Number(
                        payload['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier'] ||
                        payload['UserId'] ||
                        payload['nameid'] ||
                        payload['sub']
                    );
                } catch (error) {
                    console.error('Lỗi khi decode token:', error);
                }
            }

            if (!consultantId || isNaN(consultantId)) {
                showAlert('Không tìm thấy thông tin người dùng. Vui lòng đăng nhập lại.', 'danger');
                return;
            }

            const payload = {
                consultantId: consultantId,
                note: noteText
            };

            // Disable button while submitting
            const btn = $('#addNoteModal .btn-primary');
            const originalText = btn.html();
            btn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-1"></i> Đang lưu...');

            fetch(`${API_BASE_URL}/ServiceSchedule/${scheduleId}/notes`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
            .then(async response => {
                const result = await response.json();
                if (response.ok && result.success) {
                    $('#noteText').val('');
                    
                    // Đóng modal và xóa backdrop
                    const modalElement = document.getElementById('addNoteModal');
                    const modal = bootstrap.Modal.getInstance(modalElement);
                    if (modal) {
                        modal.hide();
                    }
                    
                    // Đợi một chút để modal đóng hoàn toàn
                    setTimeout(() => {
                        // Xóa tất cả backdrop
                        $('.modal-backdrop').remove();
                        // Xóa class modal-open
                        $('body').removeClass('modal-open');
                        // Reset CSS
                        $('body').css({
                            'overflow': '',
                            'padding-right': ''
                        });
                        // Đảm bảo body có thể scroll
                        $('html, body').css('overflow', 'auto');
                    }, 300);
                    
                    loadNotes();
                    showToast('Thêm ghi chú thành công!', 'success');
                } else {
                    const errorMessage = result.message || `Không thể thêm ghi chú (HTTP ${response.status})`;
                    showToast(errorMessage, 'error');
                }
            })
            .catch(error => {
                console.error('Error adding note:', error);
                showToast('Lỗi khi thêm ghi chú. Vui lòng thử lại.', 'error');
            })
            .finally(() => {
                btn.prop('disabled', false).html(originalText);
            });
        }

        function cancelSchedule() {
            // Hiển thị modal xác nhận
            const confirmModal = new bootstrap.Modal(document.getElementById('confirmCancelModal'));
            confirmModal.show();
        }

        function confirmCancel() {
            const token = localStorage.getItem('authToken');
            fetch(`${API_BASE_URL}/ServiceSchedule/${scheduleId}/cancel`, {
                method: 'PUT',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : '',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            })
            .then(async response => {
                const result = await response.json();
                if (result.success) {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('confirmCancelModal'));
                    if (modal) {
                        modal.hide();
                    }
                    setTimeout(() => {
                        $('.modal-backdrop').remove();
                        $('body').removeClass('modal-open');
                        $('body').css({ 'overflow': '', 'padding-right': '' });
                        $('html, body').css('overflow', 'auto');
                    }, 300);
                    showToast('Hủy lịch hẹn thành công!', 'success');
                    loadScheduleDetails();
                } else {
                    showToast('Lỗi: ' + (result.message || 'Không thể hủy lịch hẹn'), 'error');
                }
            })
            .catch(error => {
                console.error('Error cancelling schedule:', error);
                showToast('Lỗi khi hủy lịch hẹn', 'error');
            });
        }

        function completeSchedule() {
            // Hiển thị modal xác nhận
            const confirmModal = new bootstrap.Modal(document.getElementById('confirmCompleteModal'));
            confirmModal.show();
        }

        function confirmComplete() {
            const token = localStorage.getItem('authToken');
            
            // Disable button while processing
            const btn = $('#confirmCompleteModal .btn-success');
            const originalText = btn.html();
            btn.prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-1"></i> Đang xử lý...');
            
            fetch(`${API_BASE_URL}/ServiceSchedule/${scheduleId}/complete`, {
                method: 'PUT',
                headers: {
                    'Authorization': token ? `Bearer ${token}` : '',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            })
            .then(async response => {
                const responseText = await response.text();
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (e) {
                    console.error('Error parsing response:', responseText);
                    throw new Error('Invalid response from server');
                }
                
                if (response.ok && result.success) {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('confirmCompleteModal'));
                    if (modal) {
                        modal.hide();
                    }
                    setTimeout(() => {
                        $('.modal-backdrop').remove();
                        $('body').removeClass('modal-open');
                        $('body').css({ 'overflow': '', 'padding-right': '' });
                        $('html, body').css('overflow', 'auto');
                    }, 300);
                    showToast('Xác nhận hoàn thành lịch hẹn thành công!', 'success');
                    loadScheduleDetails();
                } else {
                    const errorMsg = result.message || result.error || 'Không thể hoàn thành lịch hẹn';
                    console.error('Error response:', result);
                    showToast('Lỗi: ' + errorMsg, 'error');
                    btn.prop('disabled', false).html(originalText);
                }
            })
            .catch(error => {
                console.error('Error completing schedule:', error);
                showToast('Lỗi khi hoàn thành lịch hẹn: ' + error.message, 'error');
                btn.prop('disabled', false).html(originalText);
            });
        }

        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);';
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            `;
            document.body.appendChild(alertDiv);

            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }
    </script>
}


           


