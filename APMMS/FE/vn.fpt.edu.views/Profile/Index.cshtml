@{
    ViewData["Title"] = "Thông tin cá nhân";
    Layout = "~/vn.fpt.edu.views/Shared/_DashboardLayout.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="mb-0">
                            <i class="fas fa-user me-2"></i>
                            Thông tin cá nhân
                        </h4>
                        <button class="btn btn-outline-light" onclick="toggleEditMode()" id="editToggleBtn">
                            <i class="fas fa-edit me-1"></i> Chỉnh sửa
                        </button>
                    </div>
                </div>
                <div class="card-body" style="background-color: #f8f9fa;">
                    <div class="row">
                        <!-- Avatar Section -->
                        <div class="col-md-4">
                            <div class="card mb-4 border-0 shadow-sm">
                                <div class="card-header" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #2c3e50;">
                                    <h5 class="mb-0">
                                        <i class="fas fa-image me-2"></i>
                                        Ảnh đại diện
                                    </h5>
                                </div>
                                <div class="card-body text-center">
                                    <div class="position-relative d-inline-block">
                                        <img src="https://via.placeholder.com/150x150/667eea/ffffff?text=User" 
                                             alt="Avatar" 
                                             class="rounded-circle mb-3" 
                                             style="width: 150px; height: 150px; object-fit: cover; border: 4px solid #667eea;"
                                             id="userAvatar">
                                        <div class="position-absolute bottom-0 end-0">
                                            <button class="btn btn-primary btn-sm rounded-circle" onclick="document.getElementById('avatarInput').click()" id="changeAvatarBtn" style="display: none;">
                                                <i class="fas fa-camera"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="previewAvatar(this)">
                                    <p class="text-muted mb-0">Nhấn vào camera để thay đổi ảnh</p>
                                </div>
                            </div>
                        </div>

                        <!-- Profile Information -->
                        <div class="col-md-8">
                            <div class="card mb-4 border-0 shadow-sm">
                                <div class="card-header" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #2c3e50;">
                                    <h5 class="mb-0">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Thông tin cơ bản
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <form id="profileForm">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="firstName" class="form-label">
                                                        <i class="fas fa-user me-1"></i>
                                                        Họ <span class="text-danger">*</span>
                                                    </label>
                                                    <input type="text" class="form-control" id="firstName" name="firstName" value="Nguyễn" readonly>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="lastName" class="form-label">
                                                        <i class="fas fa-user me-1"></i>
                                                        Tên <span class="text-danger">*</span>
                                                    </label>
                                                    <input type="text" class="form-control" id="lastName" name="lastName" value="Văn A" readonly>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="email" class="form-label">
                                                        <i class="fas fa-envelope me-1"></i>
                                                        Email <span class="text-danger">*</span>
                                                    </label>
                                                    <input type="email" class="form-control" id="email" name="email" value="nguyenvana@example.com" readonly>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="phone" class="form-label">
                                                        <i class="fas fa-phone me-1"></i>
                                                        Số điện thoại
                                                    </label>
                                                    <input type="tel" class="form-control" id="phone" name="phone" value="0123456789" readonly>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="gender" class="form-label">
                                                        <i class="fas fa-venus-mars me-1"></i>
                                                        Giới tính
                                                    </label>
                                                    <select class="form-select" id="gender" name="gender" disabled>
                                                        <option value="Male" selected>Nam</option>
                                                        <option value="Female">Nữ</option>
                                                        <option value="Other">Khác</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label for="birthDate" class="form-label">
                                                        <i class="fas fa-calendar me-1"></i>
                                                        Ngày sinh
                                                    </label>
                                                    <input type="date" class="form-control" id="birthDate" name="birthDate" value="1990-01-01" readonly>
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>

                            <!-- Work Information -->
                            <div class="card mb-4 border-0 shadow-sm">
                                <div class="card-header" style="background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); color: #2c3e50;">
                                    <h5 class="mb-0">
                                        <i class="fas fa-briefcase me-2"></i>
                                        Thông tin công việc
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="employeeId" class="form-label">
                                                    <i class="fas fa-id-badge me-1"></i>
                                                    Mã nhân viên
                                                </label>
                                                <input type="text" class="form-control" id="employeeId" name="employeeId" value="EMP001" readonly>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="role" class="form-label">
                                                    <i class="fas fa-user-tag me-1"></i>
                                                    Vai trò
                                                </label>
                                                <input type="text" class="form-control" id="role" name="role" value="Consulter" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="department" class="form-label">
                                                    <i class="fas fa-building me-1"></i>
                                                    Phòng ban
                                                </label>
                                                <input type="text" class="form-control" id="department" name="department" value="Tư vấn khách hàng" readonly>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="branch" class="form-label">
                                                    <i class="fas fa-map-marker-alt me-1"></i>
                                                    Chi nhánh
                                                </label>
                                                <input type="text" class="form-control" id="branch" name="branch" value="APMMS 1" readonly>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="startDate" class="form-label">
                                                    <i class="fas fa-calendar-check me-1"></i>
                                                    Ngày bắt đầu
                                                </label>
                                                <input type="date" class="form-control" id="startDate" name="startDate" value="2024-01-01" readonly>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="status" class="form-label">
                                                    <i class="fas fa-check-circle me-1"></i>
                                                    Trạng thái
                                                </label>
                                                <input type="text" class="form-control" id="status" name="status" value="Đang hoạt động" readonly>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="card border-0 shadow-sm">
                                <div class="card-body" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="text-muted">
                                            <i class="fas fa-info-circle me-1"></i>
                                            Cập nhật thông tin cá nhân của bạn
                                        </div>
                                        <div class="btn-group" id="actionButtons">
                                            <button type="button" class="btn btn-outline-secondary" onclick="cancelEdit()" id="cancelBtn" style="display: none;">
                                                <i class="fas fa-times me-1"></i> Hủy
                                            </button>
                                            <button type="button" class="btn btn-primary" onclick="saveProfile()" id="saveBtn" style="display: none;">
                                                <i class="fas fa-save me-1"></i> Lưu thay đổi
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let isEditMode = false;

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const inputs = document.querySelectorAll('#profileForm input, #profileForm select');
            const editBtn = document.getElementById('editToggleBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const saveBtn = document.getElementById('saveBtn');
            const changeAvatarBtn = document.getElementById('changeAvatarBtn');

            if (isEditMode) {
                // Enable edit mode
                inputs.forEach(input => {
                    input.removeAttribute('readonly');
                    input.removeAttribute('disabled');
                });
                editBtn.innerHTML = '<i class="fas fa-eye me-1"></i> Xem';
                editBtn.className = 'btn btn-outline-light';
                cancelBtn.style.display = 'inline-block';
                saveBtn.style.display = 'inline-block';
                changeAvatarBtn.style.display = 'block';
            } else {
                // Disable edit mode
                inputs.forEach(input => {
                    input.setAttribute('readonly', 'readonly');
                    if (input.tagName === 'SELECT') {
                        input.setAttribute('disabled', 'disabled');
                    }
                });
                editBtn.innerHTML = '<i class="fas fa-edit me-1"></i> Chỉnh sửa';
                editBtn.className = 'btn btn-outline-light';
                cancelBtn.style.display = 'none';
                saveBtn.style.display = 'none';
                changeAvatarBtn.style.display = 'none';
            }
        }

        function cancelEdit() {
            // Reset form to original values
            document.getElementById('firstName').value = 'Nguyễn';
            document.getElementById('lastName').value = 'Văn A';
            document.getElementById('email').value = 'nguyenvana@example.com';
            document.getElementById('phone').value = '0123456789';
            document.getElementById('gender').value = 'Male';
            document.getElementById('birthDate').value = '1990-01-01';
            
            toggleEditMode();
        }

        function saveProfile() {
            // Show loading
            const saveBtn = document.getElementById('saveBtn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i> Đang lưu...';
            saveBtn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                // Show success message
                showAlert('Cập nhật thông tin thành công!', 'success');
                
                // Reset button
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
                
                // Exit edit mode
                toggleEditMode();
            }, 1500);
        }

        function previewAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('userAvatar').src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 3000);
        }

        // Load user data from token
        document.addEventListener('DOMContentLoaded', function() {
            try {
                const token = localStorage.getItem('authToken');
                if (token) {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    const username = payload['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name'];
                    const role = payload['http://schemas.microsoft.com/ws/2008/06/identity/claims/role'];
                    
                    if (username) {
                        // Update display name in top bar
                        const userDisplayName = document.getElementById('userDisplayName');
                        if (userDisplayName) {
                            userDisplayName.textContent = username;
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        });
    </script>
}
