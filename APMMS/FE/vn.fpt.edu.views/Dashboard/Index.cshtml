@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/vn.fpt.edu.views/Shared/_DashboardLayout.cshtml";
}

<!-- Welcome Page (Default) -->
@await Html.PartialAsync("_WelcomePage")

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard JavaScript loaded');
            
            // Sidebar toggle
            const sidebarToggle = document.getElementById('sidebarToggle');
            const sidebar = document.getElementById('sidebar');
            
            console.log('Sidebar element:', sidebar);
            
            // Navigation functionality - show partial views
            function showPage(pageId) {
                console.log('Showing page:', pageId);
                try {
                    // Hide all pages with strong CSS rules
                    document.querySelectorAll('.page-content').forEach(page => {
                        page.classList.remove('active');
                        page.style.display = 'none';
                        page.style.visibility = 'hidden';
                        page.style.opacity = '0';
                        page.style.position = 'absolute';
                        page.style.left = '-9999px';
                    });
                    
                    // Show selected page
                    const page = document.getElementById(pageId + '-page');
                    console.log('Page element:', page);
                    if (page) {
                        page.classList.add('active');
                        page.style.display = 'block';
                        page.style.visibility = 'visible';
                        page.style.opacity = '1';
                        page.style.position = 'relative';
                        page.style.left = 'auto';
                        console.log('Page shown successfully');
                    } else {
                        console.warn(`Page with id "${pageId}-page" not found`);
                    }
                    
                    // Update page title
                    const pageTitle = document.querySelector(`[data-page="${pageId}"]`)?.textContent?.trim() || 'Dashboard';
                    const titleElement = document.getElementById('pageTitle');
                    if (titleElement) {
                        titleElement.textContent = pageTitle;
                    }
                } catch (error) {
                    console.error('Error showing page:', error);
                }
            }

            function setActiveNavLink(activeLink) {
                try {
                    // Remove active class from all links
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    
                    // Add active class to clicked link
                    if (activeLink) {
                        activeLink.classList.add('active');
                    }
                } catch (error) {
                    console.error('Error setting active nav link:', error);
                }
            }

            // Navigation links
            const navLinks = document.querySelectorAll('.nav-link[data-page]');
            console.log('Found nav links:', navLinks.length);
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Nav link clicked:', this);
                    
                    const pageId = this.getAttribute('data-page');
                    console.log('Page ID:', pageId);
                    
                    if (pageId) {
                        setActiveNavLink(this);
                        showPage(pageId);
                        
                        // Close mobile sidebar after navigation
                        if (window.innerWidth <= 768) {
                            sidebar.classList.remove('show');
                        }
                    }
                });
            });

            // Handle stat card clicks
            document.querySelectorAll('.stat-content a[data-page]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const pageId = this.getAttribute('data-page');
                    if (pageId) {
                        const navLink = document.querySelector(`[data-page="${pageId}"]`);
                        
                        setActiveNavLink(navLink);
                        showPage(pageId);
                        
                        // Close mobile sidebar after navigation
                        if (window.innerWidth <= 768) {
                            sidebar.classList.remove('show');
                        }
                    }
                });
            });

            // Sidebar toggle functionality
            if (sidebarToggle && sidebar) {
                sidebarToggle.addEventListener('click', function() {
                    if (window.innerWidth > 768) {
                        sidebar.classList.toggle('collapsed');
                    } else {
                        sidebar.classList.toggle('show');
                    }
                });
            }
            
            // Handle mobile sidebar toggle
            const mobileToggle = document.querySelector('.mobile-sidebar-toggle');
            if (mobileToggle) {
                mobileToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('show');
                });
            }
            
            // Close sidebar when clicking outside on mobile
            document.addEventListener('click', function(e) {
                if (window.innerWidth <= 768) {
                    if (!sidebar.contains(e.target) && 
                        !sidebarToggle.contains(e.target) && 
                        !mobileToggle.contains(e.target)) {
                        sidebar.classList.remove('show');
                    }
                }
            });
            
            // Handle window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    sidebar.classList.remove('show');
                }
            });
            
            // Initialize with welcome page and hide all other pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
                page.style.visibility = 'hidden';
                page.style.opacity = '0';
                page.style.position = 'absolute';
                page.style.left = '-9999px';
            });
            
            // Show welcome page by default
            const welcomePage = document.getElementById('welcome-page');
            console.log('Welcome page element:', welcomePage);
            
            if (welcomePage) {
                welcomePage.classList.add('active');
                welcomePage.style.display = 'block';
                welcomePage.style.visibility = 'visible';
                welcomePage.style.opacity = '1';
                welcomePage.style.position = 'relative';
                welcomePage.style.left = 'auto';
                console.log('Welcome page shown');
            } else {
                console.error('Welcome page not found!');
            }
            
            // Add loading states for better UX
            function addLoadingState(element) {
                if (element) {
                    element.style.opacity = '0.7';
                    element.style.pointerEvents = 'none';
                }
            }
            
            function removeLoadingState(element) {
                if (element) {
                    element.style.opacity = '1';
                    element.style.pointerEvents = 'auto';
                }
            }
            
            // Add loading states to navigation links
            document.querySelectorAll('.nav-link[data-page]').forEach(link => {
                link.addEventListener('click', function() {
                    addLoadingState(this);
                    setTimeout(() => {
                        removeLoadingState(this);
                    }, 300);
                });
            });
            
            // Add keyboard navigation support
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && window.innerWidth <= 768) {
                    sidebar.classList.remove('show');
                }
            });
            
            // Add smooth scrolling for better UX
            document.documentElement.style.scrollBehavior = 'smooth';
            
            // Add tooltip functionality for better UX
            document.querySelectorAll('[title]').forEach(element => {
                element.addEventListener('mouseenter', function() {
                    this.style.cursor = 'help';
                });
            });
            
            // Add confirmation for important actions
            document.querySelectorAll('.btn-danger, .btn-warning').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    if (!confirm('Bạn có chắc chắn muốn thực hiện hành động này?')) {
                        e.preventDefault();
                    }
                });
            });
        });
    </script>
}